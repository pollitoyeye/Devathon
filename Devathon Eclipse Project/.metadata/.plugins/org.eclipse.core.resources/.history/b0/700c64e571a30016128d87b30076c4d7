package es.pollitoyeye.vendingmachines.utils;

import java.util.ArrayList;

import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.configuration.file.YamlConfiguration;
import org.bukkit.entity.ArmorStand;
import org.bukkit.entity.EntityType;
import org.bukkit.util.EulerAngle;

import es.pollitoyeye.vendingmachines.VendingMachines;

public class StructureManager {
	public static void placeMachine(Block bl){
		@SuppressWarnings("deprecation")
		FileConfiguration config = YamlConfiguration.loadConfiguration(VendingMachines.getPlugin().getResource("Machine.schem"));
		Location loc = bl.getLocation().clone().subtract(0.2,0,0);
		int currentPos = 0;
		for(double z = bl.getLocation().getZ() + 1; z >= bl.getLocation().getZ() - 1; z--){
			for(int y = 0; y <= 2; y++){
				Location blLoc = bl.getLocation().clone().add(0,y,0);
				blLoc.setZ(z);
				blLoc.getBlock().setType(Material.BARRIER);
			}
		}
		ArmorStand mainStand = (ArmorStand) bl.getWorld().spawnEntity(bl.getLocation().add(0.5,0,0.5), EntityType.ARMOR_STAND);
		ArrayList<ArmorStand> loadedArmorStands = new ArrayList<ArmorStand>();
		while(config.contains("" + currentPos)){
			Location spawnLoc = loc.clone().subtract(config.getDouble(currentPos + ".position.x"), config.getDouble(currentPos + ".position.y"), config.getDouble(currentPos + ".position.z"));
			spawnLoc.setYaw(Float.parseFloat(config.get(currentPos + ".yaw").toString()));
			spawnLoc.setPitch(Float.parseFloat(config.get(currentPos + ".pitch").toString()));
			ArmorStand a = (ArmorStand) loc.getWorld().spawnEntity(spawnLoc, EntityType.ARMOR_STAND);
			a.setGravity(false);
			a.setHelmet(config.getItemStack(currentPos + ".helmet"));
			a.setChestplate(config.getItemStack(currentPos + ".chestplate"));
			a.setLeggings(config.getItemStack(currentPos + ".leggings"));
			a.setBoots(config.getItemStack(currentPos + ".boots"));
			a.setItemInHand(config.getItemStack(currentPos + ".hand"));
			a.setVisible(config.getBoolean(currentPos + ".visible"));
			a.setSmall(config.getBoolean(currentPos + ".small"));
			a.setArms(config.getBoolean(currentPos + ".arms"));
			a.setBasePlate(config.getBoolean(currentPos + ".plate"));
			a.setBodyPose(new EulerAngle(config.getDouble(currentPos + ".body.x"),config.getDouble(currentPos + ".body.y"),config.getDouble(currentPos + ".body.z")));
			a.setHeadPose(new EulerAngle(config.getDouble(currentPos + ".head.x"),config.getDouble(currentPos + ".head.y"),config.getDouble(currentPos + ".head.z")));
			a.setLeftArmPose(new EulerAngle(config.getDouble(currentPos + ".leftarm.x"),config.getDouble(currentPos + ".leftarm.y"),config.getDouble(currentPos + ".leftarm.z")));
			a.setLeftLegPose(new EulerAngle(config.getDouble(currentPos + ".leftleg.x"),config.getDouble(currentPos + ".leftleg.y"),config.getDouble(currentPos + ".leftleg.z")));
			a.setRightArmPose(new EulerAngle(config.getDouble(currentPos + ".rightarm.x"),config.getDouble(currentPos + ".rightarm.y"),config.getDouble(currentPos + ".rightarm.z")));
			a.setRightLegPose(new EulerAngle(config.getDouble(currentPos + ".rightleg.x"),config.getDouble(currentPos + ".rightleg.y"),config.getDouble(currentPos + ".rightleg.z")));
			loadedArmorStands.add(a);
			currentPos++;
		}
		
	}
}
